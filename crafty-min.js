/*
 * Crafty v0.1
 * http://craftyjs.com
 *
 * Copyright 2010, Louis Stowasser
 * Dual licensed under the MIT or GPL licenses.
 */
(function(j,e){var m=function(r){return new m.fn.init(r)},i=1,n=50,c=1,g={},h={},d={},p=[],b,f,o=Array.prototype.slice,k=/\s*,\s*/,q=/\s+/;m.fn=m.prototype={init:function(v){if(typeof v==="string"){var t=0,z,A,y=false,x=false,B;if(v==="*"){for(z in h){this[+z]=h[z];t++}this.length=t;return this}if(v.indexOf(",")!==-1){x=true;B=k}else{if(v.indexOf(" ")!==-1){y=true;B=q}}for(z in h){if(!h.hasOwnProperty(z)){continue}A=h[z];if(y||x){var r=v.split(B),w=0,u=r.length,s=0;for(;w<u;w++){if(A.__c[r[w]]){s++}}if(y&&s===u||x&&s>0){this[t++]=+z}}else{if(A.__c[v]){this[t++]=+z}}}if(t>0&&!y&&!x){this.extend(g[v])}if(r&&y){for(w=0;w<u;w++){this.extend(g[r[w]])}}this.length=t}else{if(!v){v=0;if(!(v in h)){h[v]=this}}if(!(v in h)){this.length=0;return this}this[0]=v;this.length=1;if(!this.__c){this.__c={}}if(!h[v]){h[v]=this}return h[v]}return this},addComponent:function(x){var u=[],w=0,t;if(arguments.length>1){var s=0,r=arguments.length;for(;s<r;s++){this.__c[arguments[s]]=true;u.push(arguments[s])}}else{if(x.indexOf(",")!==-1){var v=x.split(k),s=0,r=v.length;for(;s<r;s++){this.__c[v[s]]=true;u.push(v[s])}}else{this.__c[x]=true;u.push(x)}}t=u.length;for(;w<t;w++){comp=g[u[w]];this.extend(comp);if(comp&&"init" in comp){comp.init.call(this)}}return this},removeComponent:function(r){delete this.__c[r];return this},has:function(r){return !!this.__c[r]},attr:function(r,s){if(arguments.length===1){if(typeof r==="string"){return this[r]}this.extend(r);this.trigger("change");return this}this[r]=s;this.trigger("change");return this},toArray:function(){return o.call(this,0)},delay:function(r,s){this.each(function(){var t=this;setTimeout(function(){r.call(t)},s)})},bind:function(t,s){if(this.length===1){if(!d[t]){d[t]={}}var r=d[t];if(!r[this[0]]){r[this[0]]=[]}r[this[0]].push(s);return this}this.each(function(){if(!d[t]){d[t]={}}var u=d[t];if(!u[this[0]]){u[this[0]]=[]}u[this[0]].push(s)});return this},unbind:function(s,r){this.each(function(){var v=d[s],u=0,t,w;if(v[this[0]]){t=v[this[0]].length}else{return this}if(t===1||!r){delete v[this[0]];return this}for(;u<t;u++){w=v[this[0]];if(w[u]==r){w.splice(u,1);u--}}});return this},trigger:function(u,v){if(this.length===1){if(d[u]&&d[u][this[0]]){var t=d[u][this[0]],s=0,r=t.length;for(;s<r;s++){t[s].call(this,v)}}return this}this.each(function(){if(d[u]&&d[u][this[0]]){var y=d[u][this[0]],x=0,w=y.length;for(;x<w;x++){y[x].call(this,v)}}});return this},each:function(t){var s=0,r=this.length;for(;s<r;s++){t.call(h[this[s]],s)}return this},destroy:function(){this.each(function(){this.trigger("remove");for(var r in d){this.unbind(r)}delete h[this[0]]})}};m.fn.init.prototype=m.fn;m.extend=m.fn.extend=function(s){var r=this;if(!s){return r}for(key in s){if(r===s[key]){continue}r[key]=s[key]}return r};m.extend({init:function(t,r,s){if(arguments.length===2){s=r;r=t;t=100}n=t||100;m.viewport.init(r,s);this.onload();f=setInterval(function(){m.trigger("enterframe",{frame:c++});m.timer.step();m.DrawList.draw()},1000/n)},stop:function(){clearInterval(f)},timer:{frames:0,prevTime:(new Date).getTime(),currTime:(new Date).getTime(),dt:0,prevFpsUpdate:0,fpsUpdateFrequency:1,fps:0,getDelta:function(){return this.dt},getFPS:function(){return this.fps},getTime:function(){return(new Date).getTime()},step:function(){this.frames+=1;this.prevTime=this.currTime;this.currTime=this.getTime();this.dt=(this.currTime-this.prevTime)/1000;if((this.currTime-this.prevFpsUpdate)/1000>this.fpsUpdateFrequency){this.fps=this.frames/this.fpsUpdateFrequency;this.prevFpsUpdate=this.currTime;this.frames=0}}},e:function(){var s=a(),r;h[s]=null;h[s]=r=m(s);if(arguments.length>0){r.addComponent.apply(r,arguments)}r.addComponent("obj");return r},c:function(s,r){g[s]=r},trigger:function(v,w){var u=d[v],t,s,r;for(t in u){if(!u.hasOwnProperty(t)){continue}r=u[t].length;for(s=0;s<r;s++){if(u[t]&&u[t][s]){u[t][s].call(m(+t),w)}}}},frame:function(){return c},onload:function(s,u){if(!arguments.length){var t=0,r=p.length,v;for(;t<r;++t){v=p[t];if(v){v.fn.call(v.ctx)}}return this}p.push({ctx:s,fn:u});return this},components:function(){return g}});function a(){var r=i++;if(r in h){return a()}return r}j.Crafty=m})(window);(function(c,b,a){(function(h){var g,j=function(m){g=m||64;this.map={}},k=Math,e=k.floor,i=" ";j.prototype={insert:function(r){var p=j.key(r),o=new f(p,r,this),n=0,m,q;for(n=p.x1;n<=p.x2;n++){for(m=p.y1;m<=p.y2;m++){q=n+i+m;if(!this.map[q]){this.map[q]=[]}this.map[q].push(r)}}return o},search:function(u,n){var v=j.key(u),t,p,r,s,m,q=[],o=[],w={};if(n===undefined){n=true}for(t=v.x1;t<=v.x2;t++){for(p=v.y1;p<=v.y2;p++){r=t+i+p;if(this.map[r]){q=q.concat(this.map[r])}}}if(n){for(t=0,l=q.length;t<l;t++){s=q[t];if(!s){continue}m=s[0];if(!w[m]&&s.x<u.x+u.w&&s.x+s.w>u.x&&s.y<u.y+u.h&&s.h+s.y>u.y){w[m]=q[t]}}for(s in w){o.push(w[s])}return o}else{return q}},remove:function(s,u){var r=0,q,t;if(arguments.length==1){u=s;s=j.key(u)}for(r=s.x1;r<=s.x2;r++){for(q=s.y1;q<=s.y2;q++){t=r+i+q;if(this.map[t]){var p=this.map[t],o=0,v=p.length;for(;o<v;o++){if(p[o]&&p[o][0]===u[0]){p.splice(o,1)}}}}}}};j.key=function(q){var n=e(q.x/g),p=e(q.y/g),m=e((q.w+q.x)/g),o=e((q.h+q.y)/g);return{x1:n,y1:p,x2:m,y2:o}};j.hash=function(m){return m.x1+i+m.y1+i+m.x2+i+m.y2};function f(m,o,n){this.keys=m;this.map=n;this.obj=o}f.prototype={update:function(m){if(j.hash(j.key(m))!=j.hash(this.keys)){this.map.remove(this.keys,this.obj);var n=this.map.insert(this.obj);this.keys=n.keys}}};h.HashMap=j})(c);c.map=new c.HashMap();c.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:true,_global:null,_origin:null,_mbr:null,_entry:null,_attachy:[],_changed:false,_offscreen:false,init:function(){this._global=this[0];this._origin={x:0,y:0};if(c.support.setter){this.__defineSetter__("x",function(e){this._attr("_x",e)});this.__defineSetter__("y",function(e){this._attr("_y",e)});this.__defineSetter__("w",function(e){this._attr("_w",e)});this.__defineSetter__("h",function(e){this._attr("_h",e)});this.__defineSetter__("z",function(e){this._attr("_z",e)});this.__defineSetter__("rotation",function(e){this._attr("_rotation",e)});this.__defineSetter__("alpha",function(e){this._attr("_alpha",e)});this.__defineSetter__("visible",function(e){this._attr("_visible",e)});this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y});this.__defineGetter__("w",function(){return this._w});this.__defineGetter__("h",function(){return this._h});this.__defineGetter__("z",function(){return this._z});this.__defineGetter__("rotation",function(){return this._rotation});this.__defineGetter__("alpha",function(){return this._alpha});this.__defineGetter__("visible",function(){return this._visible})}else{if(c.support.defineProperty){Object.defineProperty(this,"x",{set:function(e){this._attr("_x",e)},get:function(){return this._x}});Object.defineProperty(this,"y",{set:function(e){this._attr("_y",e)},get:function(){return this._y}});Object.defineProperty(this,"w",{set:function(e){this._attr("_w",e)},get:function(){return this._w}});Object.defineProperty(this,"h",{set:function(e){this._attr("_h",e)},get:function(){return this._h}});Object.defineProperty(this,"z",{set:function(e){this._attr("_z",e)},get:function(){return this._z}});Object.defineProperty(this,"rotation",{set:function(e){this._attr("_rotation",e)},get:function(){return this._rotation}});Object.defineProperty(this,"alpha",{set:function(e){this._attr("_alpha",e)},get:function(){return this._alpha}});Object.defineProperty(this,"visible",{set:function(e){this._attr("_visible",e)},get:function(){return this._visible}})}else{this.x=this._x;this.y=this._y;this.w=this._w;this.h=this._h;this.z=this._z;this.rotation=this._rotation;this.alpha=this._alpha;this.visible=this._visible;this.bind("enterframe",function(){if(this.x!==this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z||this.rotation!==this._rotation||this.alpha!==this._alpha||this.visible!==this._visible){var e=this.mbr()||this.pos();if(this.rotation!==this._rotation){this._rotate(this.rotation)}else{var f=this._mbr;if(f){if(this.x!==this._x){f._x-=this.x-this._x}else{if(this.y!==this._y){f._y-=this.y-this._y}else{if(this.w!==this._w){f._w-=this.w-this._w}else{if(this.h!==this._h){f._h-=this.h-this._h}else{if(this.z!==this._z){f._z-=this.z-this._z}}}}}}}this._x=this.x;this._y=this.y;this._w=this.w;this._h=this.h;this._z=this.z;this._rotation=this.rotation;this._alpha=this.alpha;this._visible=this.visible;this.trigger("move",e);this.trigger("change",e)}})}}this._entry=c.map.insert(this);c.DrawList.add(this);this.bind("move",function(){this._entry.update(this);if(this._x+this._w<0-this.buffer&&this._y+this._h<0-this.buffer&&this._x>c.viewport.width+this.buffer&&this._y>c.viewport.height+this.buffer){c.DrawList.remove(this);this._offscreen=true}if(this._offscreen&&(this._x+this._w>0-this.buffer&&this._y+this._h>0-this.buffer&&this._x<c.viewport.width+this.buffer&&this._y<c.viewport.height+this.buffer)){c.DrawList.add(this);this._offscreen=false}});this.bind("remove",function(){c.map.remove(this);c.DrawList.remove(this);this.detach()});this.bind("change",function(){c.DrawList.change=true})},_rotate:function(q){var p=-1*(q%360),y=p*(Math.PI/180),n=Math.cos(y),s=Math.sin(y),r={x:this._origin.x+this._x,y:this._origin.y+this._y};if(!p){this._mbr=null;if(!this._rotation%360){return}}var x=r.x+(this._x-r.x)*n+(this._y-r.y)*s,i=r.y-(this._x-r.x)*s+(this._y-r.y)*n,w=r.x+(this._x+this._w-r.x)*n+(this._y-r.y)*s,g=r.y-(this._x+this._w-r.x)*s+(this._y-r.y)*n,u=r.x+(this._x+this._w-r.x)*n+(this._y+this._h-r.y)*s,f=r.y-(this._x+this._w-r.x)*s+(this._y+this._h-r.y)*n,t=r.x+(this._x-r.x)*n+(this._y+this._h-r.y)*s,e=r.y-(this._x-r.x)*s+(this._y+this._h-r.y)*n,m=Math.floor(Math.min(x,w,u,t)),j=Math.floor(Math.min(i,g,f,e)),k=Math.ceil(Math.max(x,w,u,t)),h=Math.ceil(Math.max(i,g,f,e));this._mbr={_x:m,_y:j,_w:k-m,_h:h-j};this.trigger("rotate",{})},area:function(){return this._w*this._h},intersect:function(e,k,f,g){var i,j=this._mbr||this;if(typeof e==="object"){i=e}else{i={x:e,y:k,w:f,h:g}}return j._x<i.x+i.w&&j._x+j._w>i.x&&j._y<i.y+i.h&&j._h+j._y>i.y},within:function(e,j,f,g){var i;if(typeof e==="object"){i=e}else{i={x:e,y:j,w:f,h:g}}return i.x>=this.x&&i.x+i.w<=this.x+this.w&&i.y>=this.y&&i.y+i.h<=this.y+this.h},pos:function(){return{_x:Math.floor(this._x),_y:Math.floor(this._y),_w:Math.floor(this._w),_h:Math.floor(this._h)}},isAt:function(e,f){return this.x<=e&&this.x+this.w>=e&&this.y<=f&&this.y+this.h>=f},move:function(e,f){if(e.charAt(0)==="n"){this.y-=f}if(e.charAt(0)==="s"){this.y+=f}if(e==="e"||e.charAt(1)==="e"){this.x+=f}if(e==="w"||e.charAt(1)==="w"){this.x-=f}return this},shift:function(e,i,f,g){if(e){this.x+=e}if(i){this.y+=i}if(f){this.w+=f}if(g){this.h+=g}return this},attach:function(e){function f(k){if(!k){return}var h=this.x-k._x,g=this.y-k._y,i=this.w-k._w,j=this.h-k._h;e.shift(h,g,i,j)}this.bind("move",f);this.bind("rotate",f);this._attachy[e[0]]=f;return this},detach:function(h){if(!h){var f,e=this._attachy;for(f in e){if(!e.hasOwnProperty(f)){continue}this.unbind("move",e[f]);this._attachy[f]=null;delete this._attachy[f]}return this}var g=this._attachy[h[0]];this.unbind("move",g);this._attachy[h[0]]=null;delete this._attachy[h[0]];return this},origin:function(e,g){if(typeof e==="string"){if(e==="centre"||e==="center"||e.indexOf(" ")===-1){e=this._w/2;g=this._h/2}else{var f=e.split(" ");if(f[0]==="top"){g=0}else{if(f[0]==="bottom"){g=this._h}else{if(f[0]==="middle"||f[1]==="center"||f[1]==="centre"){g=this._h/2}}}if(f[1]==="center"||f[1]==="centre"||f[1]==="middle"){e=this._w/2}else{if(f[1]==="left"){e=0}else{if(f[1]==="right"){e=this._w}}}}}else{if(e>this._w||g>this._h||e<0||g<0){return this}}this._origin.x=e;this._origin.y=g;return this},mbr:function(){var e=this._mbr;if(!e){return}return{_x:e._x,_y:e._y,_w:e._w,_h:e._h}},_attr:function(f,g){var e=this.mbr()||this.pos();if(f==="_rotation"){this._rotate(g)}else{if(f==="_z"){this._global=parseInt(g+c.zeroFill(this[0],5),10);this.trigger("reorder")}else{if(f==="_visible"){if(g===false){c.DrawList.remove(this)}else{if(g===true){c.DrawList.add(this)}}}else{if(f!=="_alpha"){var h=this._mbr;if(h){h[f]-=this[f]-g}}}}}this[f]=g;this.trigger("move",e);this.trigger("change",e)}});c.c("collision",{collision:function(e){this.map=e;this.attach(this.map)},hit:function(n){var f=this._mbr||this,k=c.map.search(f,false),m=0,h=k.length,r={},e,j,q,o=("map" in this&&"containsPoint" in this.map),g=[];if(!h){return false}for(;m<h;++m){j=k[m];if(!j){continue}e=j[0];if(!r[e]&&j.__c[n]&&j.x<f.x+f.w&&j.x+j.w>f.x&&j.y<f.y+f.h&&j.h+j.y>f.y){r[e]=j}}for(q in r){j=r[q];if(o&&"map" in j){var p=this.SAT(this.map,j.map);if(p){g.push(p)}}else{g.push(j)}}if(!g.length){return false}return g},onhit:function(e,f){this.bind("enterframe",function(){var g=this.hit(e);if(g){f.call(this,g)}});return this},SAT:function(m,h){var y=m.points,x=h.points,v=0,r=y.length,u,t=x.length,A={x:0,y:0},e,s,p,q,o,z,f=null,n,w,g;for(;v<r;v++){w=y[(v==r-1?0:v+1)];g=y[v];A.x=-(w[1]-g[1]);A.y=(w[0]-g[0]);e=Math.sqrt(A.x*A.x+A.y*A.y);A.x/=e;A.y/=e;s=p=-1;q=o=-1;for(u=0;u<r;++u){n=y[u][0]*A.x+y[u][1]*A.y;if(n>q||q===-1){q=n}if(n<s||s===-1){s=n}}for(u=0;u<t;++u){n=x[u][0]*A.x+x[u][1]*A.y;if(n>o||o===-1){o=n}if(n<p||p===-1){p=n}}z=(s<p)?p-q:s-o;if(z>0){return false}if(z>f||f===null){f=z}}for(v=0;v<t;v++){w=x[(v==t-1?0:v+1)];g=x[v];A.x=-(w[1]-g[1]);A.y=(w[0]-g[0]);e=Math.sqrt(A.x*A.x+A.y*A.y);A.x/=e;A.y/=e;s=p=-1;q=o=-1;for(u=0;u<r;++u){n=y[u][0]*A.x+y[u][1]*A.y;if(n>q||q===-1){q=n}if(n<s||s===-1){s=n}}for(u=0;u<t;++u){n=x[u][0]*A.x+x[u][1]*A.y;if(n>o||o===-1){o=n}if(n<p||p===-1){p=n}}z=(s<p)?p-q:s-o;if(z>0){return false}if(z>f||f===null){f=z}}return{overlap:f}}});c.c("physics",{});c.polygon=function(e){if(arguments.length>1){e=Array.prototype.slice.call(arguments,0)}this.points=e};c.polygon.prototype={containsPoint:function(e,m){var h=this.points,g,f,k=false;for(g=0,f=h.length-1;g<h.length;f=g++){if(((h[g][1]>m)!=(h[f][1]>m))&&(e<(h[f][0]-h[g][0])*(m-h[g][1])/(h[f][1]-h[g][1])+h[g][0])){k=!k}}return k},shift:function(e,j){var g=0,f=this.points.length,h;for(;g<f;g++){h=this.points[g];h[0]+=e;h[1]+=j}}};c.c("DOM",{_element:null,init:function(){this._element=a.createElement("div");c.stage.elem.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("remove",this.undraw)},DOM:function(e){if(!this.has("2D")){this.addComponent("2D")}this._element=e;this._element.style.position="absolute";return this},draw:function(){var f=this._element.style,h;f.top=Math.floor(this._y)+"px";f.left=Math.floor(this._x)+"px";f.width=Math.floor(this._w)+"px";f.height=Math.floor(this._h)+"px";f.zIndex=this._z;f.opacity=this._alpha;if(this._mbr){var g="rotate("+this._rotation+"deg)",e=this._origin.x+"px "+this._origin.y+"px";f.transformOrigin=e;f.mozTransformOrigin=e;f.webkitTransformOrigin=e;f.oTransformOrigin=e;f.transform=g;f.mozTransform=g;f.webkitTransform=g;f.oTransform=g}this.trigger("draw",{style:f,type:"DOM"});if(this.has("sprite")){h=this.__coord;f.background="url('"+this.__image+"') no-repeat -"+h[0]+"px -"+h[1]+"px"}return this},undraw:function(){c.stage.elem.removeChild(this._element);return this},css:function(h){var e,g=this._element,f=g.style;for(e in h){if(!h.hasOwnProperty(e)){continue}f[e]=h[e]}this.trigger("change");return this}});try{a.execCommand("BackgroundImageCache",false,true)}catch(d){}c.extend({window:{init:function(){this.width=b.innerWidth||(b.document.documentElement.clientWidth||b.document.body.clientWidth);this.height=b.innerHeight||(b.document.documentElement.clientHeight||b.document.body.clientHeight)},width:0,height:0},inner:function(i){var h=i.getBoundingClientRect(),e=h.left,j=h.top,g,f;g=parseInt(this.getStyle(i,"border-left-width")||0,10);f=parseInt(this.getStyle(i,"border-top-width")||0,10);if(!g||!f){g=parseInt(this.getStyle(i,"borderLeftWidth")||0,10);f=parseInt(this.getStyle(i,"borderTopWidth")||0,10)}e+=g;j+=f;return{x:e,y:j}},getStyle:function(f,g){var e;if(f.currentStyle){e=f.currentStyle[g]}else{if(b.getComputedStyle){e=a.defaultView.getComputedStyle(f,null).getPropertyValue(g)}}return e}});c.extend({randRange:function(f,e){return Math.round(Math.random()*(e-f)+f)},zeroFill:function(f,e){e-=f.toString().length;if(e>0){return new Array(e+(/\./.test(f)?2:1)).join("0")+f}return f.toString()},sprite:function(m,f,e,i,g){var o,r,p,n,q,k,j;if(typeof m==="string"){e=f;f=m;m=1}if(!g&&i){g=i}i=parseInt(i||0,10);g=parseInt(g||0,10);j=c.assets[f];if(!j){j=new Image();j.src=f;c.assets[f]=j}for(o in e){if(!e.hasOwnProperty(o)){continue}r=e[o];p=r[0]*m+i;n=r[1]*m+g;q=r[2]*m||m;k=r[3]*m||m;c.c(o,{__image:f,__coord:[p,n,q,k],__tile:m,__padding:[i,g],img:j,ready:false,init:function(){this.addComponent("sprite");if(this.has("canvas")){if(this.img.complete&&this.img.width>0){this.ready=true;c.DrawList.change=true}else{var h=this;this.img.onload=function(){h.ready=true;c.DrawList.change=true}}}this.w=this.__coord[2];this.h=this.__coord[3]},sprite:function(s,v,t,u){this.__coord=[s*this.__tile+this.__padding[0],v*this.__tile+this.__padding[1],t*this.__tile||this.__tile,u*this.__tile||this.__tile];this.trigger("change")}})}return this},_events:{},addEvent:function(e,i,h,g){if(arguments.length===3){g=h;h=i;i=b.document}var f=function(j){var j=j||b.event;g.call(e,j)};if(!this._events[i+h+g]){this._events[i+h+g]=f}else{return}if(i.attachEvent){i.attachEvent("on"+h,f)}else{i.addEventListener(h,f,false)}},removeEvent:function(e,i,h,g){if(arguments.length===3){g=h;h=i;i=b.document}var f=this._events[i+h+g];if(f){if(i.detachEvent){i.detachEvent("on"+h,f)}else{i.removeEventListener(h,f,false)}delete this._events[i+h+g]}},background:function(e){c.stage.elem.style.background=e},viewport:{width:0,height:0,_x:0,_y:0,scroll:function(g,f){var e=this[g];c("2D obj").each(function(){var h=this.pos();this[g]-=e-f;if(c.support.setter===false){this[g.substr(1)]=this[g]}this.trigger("move",h)});c.DrawList.change=true;this[g]=f},rect:function(){return{x:this._x,y:this._y,w:this.width,h:this.height}},init:function(e,f){c.window.init();this.width=e||c.window.width;this.height=f||c.window.height;if(!e&&!f){a.body.style.overflow="hidden";c.addEvent(this,b,"resize",function(){c.window.init();var k,m;this.width=k=c.window.width;this.height=m=c.window.height;c.stage.elem.style.width=k;c.stage.elem.style.width=m;if(c._canvas){c._canvas.width=k;c._canvas.height=m}})}var i=a.getElementById("cr-stage");c.stage={x:0,y:0,elem:(i?i:a.createElement("div"))};if(!i){a.body.appendChild(c.stage.elem);c.stage.elem.id="cr-stage"}var g=c.stage.elem.style,j;g.width=this.width+"px";g.height=this.height+"px";g.overflow="hidden";g.position="relative";j=c.inner(c.stage.elem);c.stage.x=j.x;c.stage.y=j.y;if("__defineSetter__" in this&&"__defineGetter__" in this){this.__defineSetter__("x",function(h){this.scroll("_x",h)});this.__defineSetter__("y",function(h){this.scroll("_y",h)});this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y})}else{if("defineProperty" in Object){Object.defineProperty(this,"x",{set:function(h){this.scroll("_x",h)},get:function(){return this._x}});Object.defineProperty(this,"y",{set:function(h){this.scroll("_y",h)},get:function(){return this._y}})}else{this.x=this._x;this.y=this._y;c.e("viewport")}}}},support:{},keys:{BSP:8,TAB:9,ENT:13,SHF:16,CTR:17,ALT:18,PAU:19,CAP:20,ESC:27,SP:32,PGU:33,PGD:34,END:35,HOM:36,LA:37,UA:38,RA:39,DA:40,INS:45,DEL:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,SEM:59,EQL:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LWN:91,RWN:92,SEL:93,N0:96,N1:97,N2:98,N3:99,N4:100,N5:101,N6:102,N7:103,N8:104,N9:105,MUL:106,ADD:107,SUB:109,DEC:110,DIV:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM:144,SCR:145,COM:188,PER:190,FSL:191,ACC:192,OBR:219,BSL:220,CBR:221,QOT:222}});c.onload(this,function(){c.support.setter=("__defineSetter__" in this&&"__defineGetter__" in this);c.support.defineProperty=("defineProperty" in Object);c.support.audio=("Audio" in b)});c.c("viewport",{init:function(){this.bind("enterframe",function(){if(c.viewport._x!==c.viewport.x){c.viewport.scroll("_x",c.viewport.x)}if(c.viewport._y!==c.viewport.y){c.viewport.scroll("_y",c.viewport.y)}})}});c.c("canvas",{buffer:50,init:function(){this.bind("reorder",function(){c.DrawList.resort()})},draw:function(){if(!this.ready){return}var h={_x:Math.floor(this._x),_y:Math.floor(this._y),_w:Math.floor(this._w),_h:Math.floor(this._h)},e=c.context;if(this._mbr){e.save();e.translate(this._origin.x+this._x,this._origin.y+this._y);h._x=-this._origin.x;h._y=-this._origin.y;e.rotate((this._rotation%360)*(Math.PI/180))}if(this._alpha>0){var f=e.globalAlpha;e.globalAlpha=this._alpha}if(this.__c.sprite){var g=this.__coord;e.drawImage(this.img,g[0],g[1],g[2],g[3],h._x,h._y,h._w,h._h)}else{this.trigger("draw",{type:"canvas",pos:h})}if(this._mbr){e.restore()}if(this._alpha>0){e.globalAlpha=f}return this}});c.extend({context:null,_canvas:null,canvas:function(){var e=a.createElement("canvas");this.stage.elem.appendChild(e);if(!("getContext" in e)){c.trigger("nocanvas");return}this.context=e.getContext("2d");this._canvas=e;e.width=this.viewport.width;e.height=this.viewport.height;e.style.position="absolute"}});c.extend({down:null,over:null,mouseDispatch:function(k){if(k.type==="touchstart"){k.type="mousedown"}else{if(k.type==="touchmove"){k.type="mousemove"}else{if(k.type==="touchend"){k.type="mouseup"}}}var n=-1,g,f,j=0,h;f=c.map.search(c.viewport.rect());for(h=f.length;j<h;++j){if(!f[j].has("mouse")){continue}var m=f[j],o=false,r=k.clientX-c.stage.x,p=k.clientY-c.stage.y;if(m.map){if(m.map.containsPoint(r,p)){o=true}}else{if(m.isAt(r,p)){o=true}}if(o&&(m._z>=n||n===-1)){if(m._z===n&&m[0]<g[0]){continue}n=m._z;g=m}}if(g){if(k.type==="mousedown"){this.down=g}if(k.type==="mouseup"){if(this.down&&g===this.down){this.down.trigger("click",k);this.down=null;return}this.down=null}if(k.type==="mousemove"){if(this.over!==g){if(this.over){this.over.trigger("mouseout",k);this.over=null}this.over=g;g.trigger("mouseover",k);return}}g.trigger(k.type,k)}else{if(k.type==="mousemove"&&this.over){this.over.trigger("mouseout",k);this.over=null}}}});c.onload(this,function(){c.addEvent(this,c.stage.elem,"mousedown",c.mouseDispatch);c.addEvent(this,c.stage.elem,"mouseup",c.mouseDispatch);c.addEvent(this,c.stage.elem,"mousemove",c.mouseDispatch);c.addEvent(this,c.stage.elem,"touchstart",c.mouseDispatch);c.addEvent(this,c.stage.elem,"touchmove",c.mouseDispatch);c.addEvent(this,c.stage.elem,"touchend",c.mouseDispatch)});c.c("mouse",{areaMap:function(f){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);f=new c.polygon(e)}f.shift(this._x,this._y);this.map=f;this.attach(this.map);return this}});c.c("draggable",{init:function(){if(!this.has("mouse")){this.addComponent("mouse")}function e(f){this.x=(f.clientX-c.stage.x);this.y=(f.clientY-c.stage.y)}this.bind("mousedown",function(f){console.log("MOUSEDOWN");c.addEvent(this,c.stage.elem,"mousemove",e)});c.addEvent(this,c.stage.elem,"mouseup",function(){console.log("MOUSEUP");c.removeEvent(this,c.stage.elem,"mousemove",e);this.unbind("mousedown")})}});c.c("controls",{init:function(){function e(f){this.trigger(f.type,f)}c.addEvent(this,"keydown",e);c.addEvent(this,"keyup",e);this.bind("remove",function(){c.removeEvent(this,"keydown",e);c.removeEvent(this,"keyup",e)})},preventTypeaheadFind:function(f){if(!(f.metaKey||f.altKey||f.shiftKey||f.ctrlKey)&&f.preventDefault){f.preventDefault()}return this}});c.c("fourway",{__move:{left:false,right:false,up:false,down:false},_speed:3,init:function(){if(!this.has("controls")){this.addComponent("controls")}},fourway:function(f){if(f){this._speed=f}var e=this.__move;this.bind("enterframe",function(){var g=this.pos(),h=false;if(e.right){this.x+=this._speed;h=true}if(e.left){this.x-=this._speed;h=true}if(e.up){this.y-=this._speed;h=true}if(e.down){this.y+=this._speed;h=true}}).bind("keydown",function(g){if(g.keyCode===c.keys.RA||g.keyCode===c.keys.D){e.right=true}if(g.keyCode===c.keys.LA||g.keyCode===c.keys.A){e.left=true}if(g.keyCode===c.keys.UA||g.keyCode===c.keys.W){e.up=true}if(g.keyCode===c.keys.DA||g.keyCode===c.keys.S){e.down=true}this.preventTypeaheadFind(g)}).bind("keyup",function(g){if(g.keyCode===c.keys.RA||g.keyCode===c.keys.D){e.right=false}if(g.keyCode===c.keys.LA||g.keyCode===c.keys.A){e.left=false}if(g.keyCode===c.keys.UA||g.keyCode===c.keys.W){e.up=false}if(g.keyCode===c.keys.DA||g.keyCode===c.keys.S){e.down=false}this.preventTypeaheadFind(g)});return this}});c.c("twoway",{__move:{left:false,right:false,up:false,falling:false},_speed:3,init:function(){if(!this.has("controls")){this.addComponent("controls")}},twoway:function(g,f){if(g){this._speed=g}f=f||this._speed*2;var e=this.__move;this.bind("enterframe",function(){var h=this.pos(),i=false;if(e.right){this.x+=this._speed;i=true}if(e.left){this.x-=this._speed;i=true}if(e.up){this.y-=f;this._falling=true;i=true}}).bind("keydown",function(h){if(h.keyCode===c.keys.RA||h.keyCode===c.keys.D){e.right=true}if(h.keyCode===c.keys.LA||h.keyCode===c.keys.A){e.left=true}if(h.keyCode===c.keys.UA||h.keyCode===c.keys.W){e.up=true}}).bind("keyup",function(h){if(h.keyCode===c.keys.RA||h.keyCode===c.keys.D){e.right=false}if(h.keyCode===c.keys.LA||h.keyCode===c.keys.A){e.left=false}});return this}});c.c("animate",{_reels:{},_frame:null,_current:null,animate:function(e,h,o,j){if(arguments.length===2&&typeof h==="number"){this._current=e;var g=this._reels[e],f=h;this._frame={reel:g,frameTime:Math.ceil(f/g.length),frame:0,current:0};this.bind("enterframe",this.drawFrame);return this}if(typeof h==="number"){var n=j+1-h,k=h,g=[],m=this.__tile;for(;k<=j;k++){g.push([k*m,o*m])}this._reels[e]=g}else{if(typeof h==="object"){this._reels[e]=h}}return this},drawFrame:function(g){var f=this._frame;if(this._frame.current++===f.frameTime){var h=f.reel[f.frame++];this.__coord[0]=h[0];this.__coord[1]=h[1];this._frame.current=0}if(f.frame===f.reel.length&&this._frame.current===f.frameTime){f.frame=0;this.stop();return}this.trigger("change")},stop:function(){this.unbind("enterframe",this.drawFrame);this._current=null;this._frame=null;return this},isPlaying:function(e){if(!e){return !!this._interval}return this._current===e}});c.c("color",{_color:"",init:function(){this.bind("draw",function(f){if(f.type==="DOM"){f.style.background=this._color;f.style.lineHeight=0}else{if(f.type==="canvas"){if(this._color){c.context.fillStyle=this._color}c.context.fillRect(f.pos._x,f.pos._y,f.pos._w,f.pos._h)}}})},color:function(e){this._color=e;this.trigger("change");return this}});c.c("image",{_repeat:"repeat",_ready:false,init:function(){this.bind("draw",function(f){if(f.type==="canvas"){this.canvasDraw(f)}else{if(f.type==="DOM"){if(this.__image){f.style.background="url("+this.__image+") "+this._repeat}}}})},image:function(f,g){this.__image=f;this._repeat=g||"repeat";if(this.has("canvas")){this.img=c.assets[f];if(!this.img){this.img=new Image();c.assets[f]=this.img;this.img.src=f;var e=this;this.img.onload=function(){e._pattern=c.context.createPattern(e.img,e._repeat);e._ready=true;e.trigger("change")};return this}this._ready=true;this._pattern=c.context.createPattern(this.img,this._repeat)}this.trigger("change");return this},canvasDraw:function(g){if(!this._ready){return}var f=c.context;f.fillStyle=this._pattern;f.save();f.translate(g.pos._x,g.pos._y);f.fillRect(0,0,g.pos._w,g.pos._h);f.restore()}});c.extend({_scenes:[],_current:null,scene:function(e,f){if(arguments.length===1){c("2D").each(function(){if(!this.has("persist")){this.destroy()}});this._scenes[e].call(this);this._current=e;return}this._scenes[e]=f;return}});c.DrawList=(function(){var h=[];if(!Array.prototype.indexOf){Array.prototype.indexOf=function(n,o){for(var m=(o||0),k=this.length;m<k;m++){if(this[m]==n){return m}}return -1}}return{add:function i(j){if(h.indexOf(j)===-1){h.push(j);h.sort(function(m,k){return m._global-k._global})}},remove:function f(k){var j=h.indexOf(k);if(j!==-1){h.splice(j,1)}},draw:function e(){if(!this.change){return}c.context.clearRect(0,0,c._canvas.width,c._canvas.height);var k=0,j=h.length;for(;k<j;k++){if(!h[k]||!("draw" in h[k])){this.remove(h[k]);continue}h[k].draw()}this.change=false},resort:function g(){h.sort(function(k,j){return k._global-j._global})},debug:function(){return h},change:false,}})();c.c("group",{_children:[],group:function(e){this._children=e;this.bind("move",function(o){var h=o._x-this.x,g=o._y-this.y,j=o._w-this.w,m=o._h-this.h,k=0,f=this._children.length,n;for(;k<f;k++){n=this._children[k];if(h){n.x-=h}if(g){n.y-=g}if(j){n.w-=j}if(m){n.h-=m}}});this.bind("remove",function(){var g=0,f=this._children.length,h;for(;g<f;g++){h.destroy()}});return this}});c.extend({group:function(){var o=c.e("2D, group"),m=Array.prototype.slice.call(arguments),j=0,g=m.length,h,e,f,n,k;for(;j<g;j++){k=m[j];k.removeComponent("obj");if(k.x<h||!h){h=k.x}if(k.x+k.w>h+e||!e){e=k.x+k.w-h}if(k.y<f||!f){f=k.y}if(k.y+k.h<f+n||!n){n=k.y+k.h-f}}o.attr({x:h,y:f,w:e,h:n}).group(m);return o}});c.extend({isometric:{_tile:0,_z:0,init:function(e){this._tile=e;return this},place:function(f,j,h,g){var e=f*this._tile+(j&1)*(this._tile/2),i=j*this._tile/4,i=i-h*(this._tile/2);g.attr({x:e+c.viewport._x,y:i+c.viewport._y}).z+=h;return this},zoom:function(e){this._tile=e;c.trigger("zoom",{tile:e});return this}}});c.extend({audio:{_elems:{},MAX_CHANNELS:5,type:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},add:function(h,g){if(!c.support.audio){return}var m,q,o=new Audio(),j,p=0,k=[];if(arguments.length===1&&typeof h==="object"){for(q in h){if(!h.hasOwnProperty(q)){continue}if(typeof h[q]!=="string"){var f=h[q],p=0,n=f.length,e;for(;p<n;++p){e=f[p];ext=e.substr(e.lastIndexOf(".")+1).toLowerCase();j=o.canPlayType(this.type[ext]);if(j!==""&&j!=="no"){g=e;break}}}else{g=h[q]}for(;p<this.MAX_CHANNELS;p++){o=new Audio(g);o.preload="auto";o.load();k.push(o)}this._elems[q]=k;if(!c.assets[g]){c.assets[g]=this._elems[q][0]}}return this}if(typeof g!=="string"){var p=0,n=g.length,e;for(;p<n;++p){e=g[p];ext=e.substr(e.lastIndexOf(".")+1);j=o.canPlayType(this.type[ext]);if(j!==""&&j!=="no"){g=e;break}}}for(;p<this.MAX_CHANNELS;p++){o=new Audio(g);o.preload="auto";o.load();k.push(o)}this._elems[q]=k;if(!c.assets[g]){c.assets[g]=this._elems[q][0]}return this},play:function(j){if(!c.support.audio){return}var e=this._elems[j],h,g=0,f=e.length;for(;g<f;g++){h=e[g];if(h.ended||!h.currentTime){h.play();break}else{if(g===f-1){h.currentTime=0;h.play()}}}return this},settings:function(n,k){if(!k){for(var h in this._elems){this.settings(h,n)}return this}var e=this._elems[n],m,j,g=0,f=e.length;for(var j in k){for(;g<f;g++){m=e[g];m[j]=k[j]}}return this}}});c.c("text",{_text:"",_font:"",init:function(){this.bind("draw",function(h){if(h.type==="DOM"){var g=this._element,f=g.style;g.innerHTML=this._text;f.font=this._font}else{}})},text:function(e){if(!e){return this._text}this._text=e;this.trigger("change");return this},font:function(e){this._font=e;this.trigger("change");return this}});c.c("health",{_mana:100,health:function(e){this._mana=e;return this},hurt:function(e){this._mana-=e;this.trigger("hurt",{by:e,mana:this._mana});if(this._mana<=0){this.trigger("die")}return this},heal:function(e){this._mana+=e;this.trigger("heal");return this}});c.c("score",{_score:0,incrementScore:function(e){this._score+=e;return this},decrementScore:function(e){this._score-=e;return this}});c.extend({assets:{},load:function(m,f,e,p){var n=0,g=m.length,o,k,q=g,h=0;for(;n<g;++n){o=m[n];ext=o.substr(o.lastIndexOf(".")+1).toLowerCase();if(c.support.audio&&(ext==="mp3"||ext==="wav"||ext==="ogg"||ext==="mp4")){k=new Audio(o)}else{if(ext==="jpg"||ext==="jpeg"||ext==="gif"||ext==="png"){k=new Image();k.src=o}else{q--;continue}}this.assets[o]=k;k.onload=function(){++h;if(e){e.call(this,{loaded:h,total:q,percent:(h/q*100)})}if(h===q){if(f){f()}}};k.onerror=function(){if(p){p.call(this,{loaded:h,total:q,percent:(h/q*100)})}}}}})})(Crafty,window,window.document);