(function(i,e){var k=function(p){return new k.fn.init(p)},h=1,l=50,c=1,f={},g={},d={},n=[],b,m=Array.prototype.slice,j=/\s*,\s*/,o=/\s+/;k.fn=k.prototype={init:function(t){if(typeof t==="string"){var r=0,x,w=false,u=false,y;if(t.indexOf(",")!==-1){u=true;y=j}else{if(t.indexOf(" ")!==-1){w=true;y=o}}for(x in g){if(!g.hasOwnProperty(x)){continue}if(w||u){var p=t.split(y),v=0,s=p.length,q=0;for(;v<s;v++){if(k(+x).has(p[v])){q++}}if(w&&q===s||u&&q>0){this[r++]=+x}}else{if(k(+x).has(t)){this[r++]=+x}}}if(r>0&&!w&&!u){this.extend(f[t])}if(p&&w){for(v=0;v<s;v++){this.extend(f[p[v]])}}this.length=r}else{if(!t){t=0;if(!(t in g)){g[t]=this}}if(!(t in g)){this.length=0;return this}this[0]=t;this.length=1;if(!this.__c){this.__c={}}if(!g[t]){g[t]=this}return g[t]}return this},addComponent:function(v){var s=[],u=0,r;if(arguments.length>1){var q=0,p=arguments.length;for(;q<p;q++){this.__c[arguments[q]]=true;s.push(arguments[q])}}else{if(v.indexOf(",")!==-1){var t=v.split(j),q=0,p=t.length;for(;q<p;q++){this.__c[t[q]]=true;s.push(t[q])}}else{this.__c[v]=true;s.push(v)}}r=s.length;for(;u<r;u++){comp=f[s[u]];this.extend(comp);if(comp&&"init" in comp){comp.init.call(this)}}return this},removeComponent:function(p){delete this.__c[p];return this},has:function(p){return !!this.__c[p]},attr:function(p,q){if(arguments.length===1){if(typeof p==="string"){return this[p]}this.extend(p);this.trigger("change");return this}this[p]=q;this.trigger("change");return this},toArray:function(){return m.call(this,0)},delay:function(p,q){this.each(function(){var r=this;setTimeout(function(){p.call(r)},q)})},bind:function(q,p){this.each(function(){if(!d[q]){d[q]={}}var r=d[q];if(!r[this[0]]){r[this[0]]=[]}r[this[0]].push(p)});return this},unbind:function(q,p){this.each(function(){var t=d[q],s=0,r,u;if(t[this[0]]){r=t[this[0]].length}else{return this}if(r===1||!p){delete t[this[0]];return this}for(;s<r;s++){u=t[this[0]];if(u[s]==p){delete u[s]}}});return this},trigger:function(p,q){this.each(function(){if(d[p]&&d[p][this[0]]){var t=d[p][this[0]],s=0,r=t.length;for(;s<r;s++){t[s].call(this,q)}}});return this},each:function(r){var q=0,p=this.length;for(;q<p;q++){r.call(k(this[q]),q)}return this},destroy:function(){this.each(function(){this.trigger("remove");for(var p in d){this.unbind(p)}delete g[this[0]]})}};k.fn.init.prototype=k.fn;k.extend=k.fn.extend=function(q){var p=this;if(!q){return p}for(key in q){if(p===q[key]){continue}p[key]=q[key]}return p};k.extend({init:function(r,p,q){if(r){l=r}this.onload();k.viewport.init(p,q);k.addEvent(this,k.stage.elem,"mousedown",k.mouseDispatch);k.addEvent(this,k.stage.elem,"mouseup",k.mouseDispatch);k.addEvent(this,k.stage.elem,"mousemove",k.mouseDispatch);b=setInterval(function(){k.trigger("enterframe",{frame:c++})},1000/l)},stop:function(){clearInterval(b)},e:function(){var q=a(),p;g[q]=null;g[q]=p=k(q);if(arguments.length>0){p.addComponent.apply(p,arguments)}p.addComponent("obj");return p},c:function(q,p){f[q]=p},trigger:function(t,u){var s=d[t],r,q,p;for(r in s){if(!s.hasOwnProperty(r)){continue}p=s[r].length;for(q=0;q<p;q++){if(s[r]&&s[r][q]){s[r][q].call(k(+r),u)}}}},frame:function(){return c},onload:function(q,s){if(!arguments.length){var r=0,p=n.length,t;for(;r<p;++r){t=n[r];if(t){t.fn.call(t.ctx)}}return this}n.push({ctx:q,fn:s});return this},debug:function(){if(console){console.log("Entities: ",g);console.log("Components: ",f);console.log("Handlers: ",d)}}});function a(){var p=h++;if(p in g){return a()}return p}i.Crafty=k})(window);if(!("console" in window)){window.console={log:function(){}}}(function(d,c,a){d.map=new d.HashMap();d.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_entry:null,init:function(){if("__defineSetter__" in this&&"__defineGetter__" in this){this.__defineSetter__("x",function(e){this._attr("_x",e)});this.__defineSetter__("y",function(e){this._attr("_y",e)});this.__defineSetter__("w",function(e){this._attr("_w",e)});this.__defineSetter__("h",function(e){this._attr("_h",e)});this.__defineSetter__("z",function(e){this._attr("_z",e)});this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y});this.__defineGetter__("w",function(){return this._w});this.__defineGetter__("h",function(){return this._h});this.__defineGetter__("z",function(){return this._z})}else{this.x=this._x;this.y=this._y;this.w=this._w;this.h=this._h;this.z=this._z;this.bind("enterframe",function(){if(this.x!==this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z){var e=this.pos();this._x=this.x;this._y=this.y;this._w=this.w;this._h=this.h;this._z=this.z;this.trigger("move",e);this.trigger("change",e)}});d.support.setter=false}this._entry=d.map.insert(this);this.bind("move",function(){this._entry.update(this)});this.bind("remove",function(){d.map.remove(this)})},area:function(){return this._w*this._h},intersect:function(e,l,i,j){var k;if(typeof e==="object"){k=e}else{k={x:e,y:l,w:i,h:j}}return this._x<k.x+k.w&&this._x+this._w>k.x&&this._y<k.y+k.h&&this._h+this._y>k.y},within:function(e,l,i,j){var k;if(typeof e==="object"){k=e}else{k={x:e,y:l,w:i,h:j}}return k.x>=this.x&&k.x+k.w<=this.x+this.w&&k.y>=this.y&&k.y+k.h<=this.y+this.h},pos:function(){return{_x:Math.floor(this._x),_y:Math.floor(this._y),_w:Math.floor(this._w),_h:Math.floor(this._h)}},isAt:function(e,i){return this.x<=e&&this.x+this.w>=e&&this.y<=i&&this.y+this.h>=i},move:function(e,i){if(e.charAt(0)==="n"){this.y-=i}if(e.charAt(0)==="s"){this.y+=i}if(e==="e"||e.charAt(1)==="e"){this.x+=i}if(e==="w"||e.charAt(1)==="w"){this.x-=i}},shift:function(e,k,i,j){if(e){this.x+=e}if(k){this.y+=k}if(i){this.w+=i}if(j){this.h+=j}},attatch:function(e){this.bind("move",function(m){if(!m){return}var j=this.x-m._x,i=this.y-m._y,k=this.w-m._w,l=this.h-m._h;e.shift(j,i,k,l)})},_attr:function(i,j){var e=this.pos();this[i]=j;this.trigger("move",e);this.trigger("change",e)}});d.c("gravity",{_gravity:0.2,_gy:0,_bounce:0.8,_friction:0.8,_falling:true,_anti:null,init:function(){if(!this.has("2D")){this.addComponent("2D")}},gravity:function(e){this._anti=e;this.bind("enterframe",function(){if(this._falling){this._gy+=this._gravity*2;this.y+=this._gy}else{this._gy=0}var j=this,i=false;d(e).each(function(){if(this.intersect(j.x,j.y+1,j.w,j.h)){i=this}});if(i){if(this._falling){this.stopFalling(i)}}else{this._falling=true}});return this},stopFalling:function(i){if(i){this.y=i.y-this.h}this._falling=false;if(this.__move&&this.__move.up){this.__move.up=false}this.trigger("hit")}});d.c("collision",{collision:function(e,i){var j=this;this.bind("enterframe",function(){if(typeof e==="string"){d(e).each(function(){if(this.intersect(j)){i.call(j,this)}})}else{if(typeof e==="object"){if(e.intersect(j)){i.call(j,e)}}}});return this}});d.polygon=function(e){if(arguments.length>1){e=Array.prototype.slice.call(arguments,0)}this.points=e};d.polygon.prototype={containsPoint:function(e,o){var m=this.points,l,k,n=false;for(l=0,k=m.length-1;l<m.length;k=l++){if(((m[l][1]>o)!=(m[k][1]>o))&&(e<(m[k][0]-m[l][0])*(o-m[l][1])/(m[k][1]-m[l][1])+m[l][0])){n=!n}}return n},shift:function(e,n){var k=0,j=this.points.length,m;for(;k<j;k++){m=this.points[k];m[0]+=e;m[1]+=n}}};d.c("DOM",{_element:null,init:function(){this._element=a.createElement("div");d.stage.elem.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("change",this.draw);this.bind("remove",this.undraw)},DOM:function(e){if(!this.has("2D")){this.addComponent("2D")}this._element=e;this._element.style.position="absolute";return this},draw:function(){var e=this._element.style,i;e.top=Math.floor(this._y)+"px";e.left=Math.floor(this._x)+"px";e.width=Math.floor(this._w)+"px";e.height=Math.floor(this._h)+"px";e.zIndex=this.z;this.trigger("draw",{style:e,type:"DOM"});if(this.has("sprite")){i=this.__coord;e.background="url('"+this.__image+"') no-repeat -"+i[0]+"px -"+i[1]+"px"}},undraw:function(){d.stage.elem.removeChild(this._element)},css:function(k){var e,j=this._element,i=j.style;for(e in k){if(!k.hasOwnProperty(e)){continue}i[e]=k[e]}this.trigger("change")}});try{a.execCommand("BackgroundImageCache",false,true)}catch(g){}d.extend({inner:function(l){var k=l.getBoundingClientRect(),e=k.left,m=k.top,j,i;j=parseInt(this.getStyle(l,"border-left-width")||0,10);i=parseInt(this.getStyle(l,"border-top-width")||0,10);if(!j||!i){j=parseInt(this.getStyle(l,"borderLeftWidth")||0,10);i=parseInt(this.getStyle(l,"borderTopWidth")||0,10)}e+=j;m+=i;return{x:e,y:m}},getStyle:function(i,j){var e;if(i.currentStyle){e=i.currentStyle[j]}else{if(c.getComputedStyle){e=a.defaultView.getComputedStyle(i,null).getPropertyValue(j)}}return e}});d.extend({randRange:function(i,e){return Math.round(Math.random()*(e-i)+i)},sprite:function(k,i,e){var l,p,n,m,o,j;if(typeof k==="string"){e=i;i=k;k=1}for(l in e){if(!e.hasOwnProperty(l)){continue}p=e[l];n=p[0]*k;m=p[1]*k;o=p[2]*k||k;j=p[3]*k||k;d.c(l,{__image:i,__coord:[n,m,o,j],__tile:k,init:function(){this.addComponent("sprite");if(this.has("canvas")){this.img=new Image();this.img.src=this.__image;d.addEvent(this,this.img,"load",function(){b.add(this)})}this.w=this.__coord[2];this.h=this.__coord[3]},sprite:function(q,t,r,s){this.__coord=[q*this.__tile,t*this.__tile,r*this.__tile||this.__tile,s*this.__tile||this.__tile];if(this.has("canvas")){b.add(this)}else{if(this.has("DOM")){this.draw()}}}})}return this},_events:{},addEvent:function(e,l,k,j){if(arguments.length===3){j=k;k=l;l=c.document}var i=function(m){var m=m||c.event;j.call(e,m)};this._events[l+k+j]=i;if(l.attachEvent){l.attachEvent("on"+k,i)}else{l.addEventListener(k,i,false)}},removeEvent:function(e,l,k,j){if(arguments.length===3){j=k;k=l;l=c.document}var i=this._events[l+k+j];if(i){if(l.detachEvent){l.detachEvent("on"+k,i)}else{l.removeEventListener(k,i,false)}delete this._events[l+k+j]}},window:{width:c.innerWidth||(c.document.documentElement.clientWidth||c.document.body.clientWidth),height:c.innerHeight||(c.document.documentElement.clientHeight||c.document.body.clientHeight)},background:function(e){d.stage.elem.style.background=e},viewport:{width:0,height:0,_x:0,_y:0,scroll:function(r,B){var p=this[r],e,x=0,w=0,t,s,y,C={},A,z=[];if(d.context){d.context.clearRect(0,0,this.width,this.height)}A={x:r=="_x"?p:this._x,y:r=="_y"?p:this._y,w:this.width,h:this.height};e=d.map.search(A,false);for(t=e.length;x<t;++x){y=e[x];if(!C[y[0]]){C[y[0]]=true;if(!z[y._z]){z[y._z]=[]}z[y._z].push(y)}}d("2D obj").each(function(){var i=this.pos();this[r]-=p-B;if(d.support.setter===false){this[r.substr(1)]=this[r];this.trigger("change",i)}this.trigger("move",i)});s=z.length;for(;w<s;w++){if(!z[w]){continue}var u=0,o=z[w].length;for(;u<o;u++){if("draw" in z[w][u]){z[w][u].draw()}}}this[r]=B},rect:function(){return{x:this._x,y:this._y,w:this.width,h:this.height}},init:function(e,i){this.width=e||d.window.width;this.height=i||d.window.height;if(!e&&!i){a.body.style.overflow="hidden"}d.stage={x:0,y:0,elem:a.createElement("div")};a.body.appendChild(d.stage.elem);d.stage.elem.id="cr-stage";var j=d.stage.elem.style,k;j.width=this.width+"px";j.height=this.height+"px";j.overflow="hidden";j.position="relative";k=d.inner(d.stage.elem);d.stage.x=k.x;d.stage.y=k.y;if("__defineSetter__" in this&&"__defineGetter__" in this){this.__defineSetter__("x",function(l){this.scroll("_x",l)});this.__defineSetter__("y",function(l){this.scroll("_y",l)});this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y})}else{this.x=this._x;this.y=this._y;d.e("viewport")}}},support:{},keys:{BSP:8,TAB:9,ENT:13,SHF:16,CTR:17,ALT:18,PAU:19,CAP:20,ESC:27,SP:32,PGU:33,PGD:34,END:35,HOM:36,LA:37,UA:38,RA:39,DA:40,INS:45,DEL:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,SEM:59,EQL:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LWN:91,RWN:92,SEL:93,N0:96,N1:97,N2:98,N3:99,N4:100,N5:101,N6:102,N7:103,N8:104,N9:105,MUL:106,ADD:107,SUB:109,DEC:110,DIV:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM:144,SCR:145,COM:188,PER:190,FSL:191,ACC:192,OBR:219,BSL:220,CBR:221,QOT:222}});d.c("viewport",{init:function(){this.bind("enterframe",function(){if(d.viewport._x!==d.viewport.x){d.viewport.scroll("_x",d.viewport.x)}if(d.viewport._y!==d.viewport.y){d.viewport.scroll("_y",d.viewport.y)}})}});var b={add:function f(i,e){this.redraw(i,e);this.redraw(i)},redraw:function h(v,l){var A,C=0,B=0,n,o,t,p,F,G=0,E=false,e={},k=[];if(!l){E=true}l=l||v;A=d.map.search({x:l._x,y:l._y,w:l._w,h:l._h},false);for(C=0;C<A.length;++C){t=A[C];if(t.isCanvas&&!e[t[0]]&&t._x<l._x+l._w&&t._x+t._w>l._x&&t._y<l._y+l._h&&t._h+t._y>l._y){e[t[0]]=true;if(t===v&&!E){continue}if(!k[t._z]){k[t._z]=[]}k[t._z].push(t);++G}}if(G==0){return}if(G==1&&E){v.draw();return}for(C=0,n=k.length;C<n;++C){if(!k[C]){continue}F=k[C];o=F.length;for(B=0;B<o;++B){var m=F[B];if(m[0]!==v[0]){var s=(l._x-m._x<=0)?0:(l._x-m._x),r=Math.ceil(l._y-m._y<0?0:(l._y-m._y)),u=Math.min(m._w-s,l._w-(m._x-l._x),l._w),D=Math.ceil(Math.min(m._h-r,l._h-(m._y-l._y),l._h));if(D===0||u===0){continue}m.draw(s,r,u,D)}else{m.draw()}}}},remove:function(e){this.redraw(e,e)}};d.c("canvas",{isCanvas:true,buffer:50,init:function(){this.bind("change",function(i){i=i||this;d.context.clearRect(i._x,i._y,i._w,i._h);if((i._x+i._w>0-this.buffer&&i._y+i._h>0-this.buffer&&i._x<d.viewport.width+this.buffer&&i._y<d.viewport.height+this.buffer)||(this._x+this._w>0-this.buffer&&this._y+this._h>0-this.buffer&&this._x<d.viewport.width+this.buffer&&this._y<d.viewport.height+this.buffer)){b.add(this,i)}});this.bind("remove",function(){d.context.clearRect(this._x,this._y,this._w,this._h);b.remove(this)})},draw:function(e,n,i,j){var k={},m={_x:Math.floor(this._x),_y:Math.floor(this._y),_w:Math.floor(this._w),_h:Math.floor(this._h)},l=this.__coord||[];k.x=l[0];k.y=l[1];k.w=l[2];k.h=l[3];if(e!==undefined){k.x=l[0]+e;m._x+=e;if(n!==undefined){k.y=l[1]+n;m._y+=n}if(i!==undefined){k.w=i;m._w=i}if(j!==undefined){k.h=j;m._h=j}}this.trigger("draw",{type:"canvas",spritePos:k,pos:m});if(this.__c.sprite){if(!this.img.width){return}d.context.drawImage(this.img,k.x,k.y,k.w,k.h,m._x,m._y,m._w,m._h)}}});d.extend({context:null,_canvas:null,gz:0,canvas:function(e){if(typeof e==="string"){e=a.getElementById(e)}else{if(!e){e=a.createElement("canvas");this.stage.elem.appendChild(e)}}if(!("getContext" in e)){d.trigger("nocanvas");return}this.context=e.getContext("2d");this._canvas=e;this._canvas.width=this.viewport.width;this._canvas.height=this.viewport.height}});d.extend({down:null,over:null,mouseDispatch:function(o){var r=-1,k,j,n=0,m;j=d.map.search(d.viewport.rect());for(m=j.length;n<m;++n){if(!j[n].has("mouse")){continue}var p=j[n],s=false,u=o.clientX-d.stage.x,t=o.clientY-d.stage.y;if(p.map){if(p.map.containsPoint(u,t)){s=true}}else{if(p.isAt(u,t)||p.has("DOM")){s=true}}if(s&&(p._z>=r||r===-1)){if(p._z===r&&p[0]<k[0]){continue}r=p._z;k=p}}if(k){if(o.type==="mousedown"){this.down=k}if(o.type==="mouseup"){if(this.down&&k===this.down){this.down.trigger("click",o);this.down=null;return}this.down=null}if(o.type==="mousemove"){if(this.over!==k){if(this.over){this.over.trigger("mouseout",o);this.over=null}this.over=k;k.trigger("mouseover",o);return}}k.trigger(o.type,o)}else{if(o.type==="mousemove"&&this.over){this.over.trigger("mouseout",o);this.over=null}}}});d.c("mouse",{areaMap:function(m){if(arguments.length>1){var j=Array.prototype.slice.call(arguments,0),k=0,e=j.length;for(;k<e;k++){j[k][0]+=this.x;j[k][1]+=this.y}m=new d.polygon(j)}this.map=m;this.attatch(this.map);return this}});d.c("controls",{__move:{left:false,right:false,up:false,down:false},_speed:3,init:function(){function e(i){this.trigger(i.type,i)}d.addEvent(this,"keydown",e);d.addEvent(this,"keyup",e);this.bind("remove",function(){d.removeEvent(this,"keydown",e);d.removeEvent(this,"keyup",e)});return this}});d.c("fourway",{fourway:function(i){if(i){this._speed=i}var e=this.__move;this.bind("enterframe",function(){var j=this.pos(),k=false;if(e.right){this.x+=this._speed;k=true}if(e.left){this.x-=this._speed;k=true}if(e.up){this.y-=this._speed;k=true}if(e.down){this.y+=this._speed;k=true}if(k){this.trigger("change",j)}}).bind("keydown",function(j){if(j.keyCode===d.keys.RA||j.keyCode===d.keys.D){e.right=true}if(j.keyCode===d.keys.LA||j.keyCode===d.keys.A){e.left=true}if(j.keyCode===d.keys.UA||j.keyCode===d.keys.W){e.up=true}if(j.keyCode===d.keys.DA||j.keyCode===d.keys.S){e.down=true}}).bind("keyup",function(j){if(j.keyCode===d.keys.RA||j.keyCode===d.keys.D){e.right=false}if(j.keyCode===d.keys.LA||j.keyCode===d.keys.A){e.left=false}if(j.keyCode===d.keys.UA||j.keyCode===d.keys.W){e.up=false}if(j.keyCode===d.keys.DA||j.keyCode===d.keys.S){e.down=false}});return this}});d.c("twoway",{__move:{left:false,right:false,up:false,falling:false},twoway:function(j,i){if(j){this._speed=j}i=i||this._speed*2;var e=this.__move;this.bind("enterframe",function(){var k=this.pos(),l=false;if(e.right){this.x+=this._speed;l=true}if(e.left){this.x-=this._speed;l=true}if(e.up){this.y-=i;this._falling=true;l=true}if(l){this.trigger("change",k)}}).bind("keydown",function(k){if(k.keyCode===d.keys.RA||k.keyCode===d.keys.D){e.right=true}if(k.keyCode===d.keys.LA||k.keyCode===d.keys.A){e.left=true}if(k.keyCode===d.keys.UA||k.keyCode===d.keys.W){e.up=true}}).bind("keyup",function(k){if(k.keyCode===d.keys.RA||k.keyCode===d.keys.D){e.right=false}if(k.keyCode===d.keys.LA||k.keyCode===d.keys.A){e.left=false}});return this}});d.c("animate",{_reels:{},_frame:null,_current:null,animate:function(e,l,q,m,j){if(arguments.length===2&&typeof l==="number"){clearInterval(this._interval);this._current=e;j=l;var k=this._reels[e];this._frame={reel:k,frameTime:Math.ceil(j/k.length),frame:0,current:0};this.bind("enterframe",this.drawFrame);return this}if(typeof l==="number"){var p=m+1-l,n=l,k=[],o=this.__tile;for(;n<=m;n++){k.push([n*o,q*o])}this._reels[e]=k}else{if(typeof l==="array"){this._reels[e]=l}}return this},drawFrame:function(j){var i=this._frame;if(this._frame.current++===i.frameTime){var k=i.reel[i.frame++];this.__coord[0]=k[0];this.__coord[1]=k[1];this._frame.current=0}if(i.frame===i.reel.length&&this._frame.current===i.frameTime){i.frame=0;this.stop();return}},stop:function(){this.unbind("enterframe",this.drawFrame);this._current=null;this._frame=null},isPlaying:function(e){if(!e){return !!this._interval}return this._current===e}});d.c("color",{_color:"",init:function(){this.bind("draw",function(i){if(i.type==="DOM"){i.style.background=this._color;i.style.lineHeight=0}else{if(i.type==="canvas"){if(this._color){d.context.fillStyle=this._color}d.context.fillRect(i.pos._x,i.pos._y,i.pos._w,i.pos._h)}}})},color:function(e){this._color=e;this.trigger("change");return this}});d.c("image",{_repeat:"repeat",init:function(){this.bind("draw",function(i){if(i.type==="canvas"){this.canvasDraw()}else{if(i.type==="DOM"){i.style.background="url("+this.__image+") "+this._repeat}}})},image:function(e,i){this.__image=e;this._repeat=i||"repeat";if(this.has("canvas")){this.img=new Image();this.img.src=e;d.addEvent(this,this.img,"load",function(){b.add(this)})}this.trigger("change");return this},canvasDraw:function(){if(!this.img){return}var o=0,e,n=0,m;switch(this._repeat){case"repeat-x":if(this.img.width===0){return}for(e=Math.floor(this._w/this.img.width);o<e;o++){d.context.drawImage(this.img,this._x+this.img.width*o,this._y)}break;case"repeat-y":if(this.img.height===0){return}for(e=Math.floor(this._h/this.img.height);o<=e;o++){d.context.drawImage(this.img,this._x,this._y+this.img.height*o)}break;default:if(this.img.width===0||this.img.height===0){return}for(e=Math.floor(this._w/this.img.width);o<e;o++){d.context.drawImage(this.img,this._x+this.img.width*o,this._y);for(n=0,m=Math.floor(this._h/this.img.height);n<=m;n++){d.context.drawImage(this.img,this._x+this.img.width*o,this._y+this.img.height*n)}}break}}});d.extend({_scenes:[],_current:null,scene:function(e,i){if(arguments.length===1){d("2D").destroy();this._scenes[e].call(this);this._current=e;return}this._scenes[e]=i;return}});d.c("group",{_children:[],group:function(e){this._children=e;this.bind("move",function(r){var m=r._x-this.x,k=r._y-this.y,n=r._w-this.w,p=r._h-this.h,o=0,j=this._children.length,q;for(;o<j;o++){q=this._children[o];if(m){q.x-=m}if(k){q.y-=k}if(n){q.w-=n}if(p){q.h-=p}}});this.bind("remove",function(){var k=0,j=this._children.length,m;for(;k<j;k++){m.destroy()}})}});d.extend({group:function(){var r=d.e("2D, group"),p=Array.prototype.slice.call(arguments),n=0,k=p.length,m,e,j,q,o;for(;n<k;n++){o=p[n];o.removeComponent("obj");if(o.x<m||!m){m=o.x}if(o.x+o.w>m+e||!e){e=o.x+o.w-m}if(o.y<j||!j){j=o.y}if(o.y+o.h<j+q||!q){q=o.y+o.h-j}}r.attr({x:m,y:j,w:e,h:q}).group(p);return r}});d.extend({isometric:{_tile:0,_z:0,init:function(e){this._tile=e;return this},place:function(i,o,k,j){var e=i*this._tile+(o&1)*(this._tile/2),l=o*this._tile/4,l=l-k*(this._tile/2);j.attr({x:e+d.viewport._x,y:l+d.viewport._y}).z+=k;return this},zoom:function(e){this._tile=e;d.trigger("zoom",{tile:e});return this}}});d.extend({audio:{_elems:{},type:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},add:function(m,k){var o,s,q=new Audio(),n;if(!q.canPlayType){return}if(arguments.length===1&&typeof m==="object"){for(s in m){if(!m.hasOwnProperty(s)){continue}if(typeof m[s]!=="string"){var j=m[s],r=0,p=j.length,e;for(;r<p;++r){e=j[r];ext=e.substr(e.lastIndexOf(".")+1);n=q.canPlayType(this.type[ext]);if(n!==""&&n!=="no"){k=e;break}}}else{k=m[s]}this._elems[s]=new Audio(k);this._elems[s].preload="auto";this._elems[s].load()}return this}if(typeof k!=="string"){var r=0,p=k.length,e;for(;r<p;++r){e=k[r];ext=e.substr(e.lastIndexOf(".")+1);n=q.canPlayType(this.type[ext]);if(n!==""&&n!=="no"){k=e;break}}}this._elems[m]=new Audio(k);this._elems[m].preload="auto";this._elems[m].load();return this},play:function(i){var e=this._elems[i];console.log(e.ended,e.currentTime,e.networkState,e.readyState);if(e.ended||!e.currentTime){e.play()}return this},settings:function(l,j){if(!j){for(var e in this._elems){this.settings(e,l)}return this}var k=this._elems[l];for(var i in j){k[i]=j[i]}return this}}});d.c("text",{_text:"",_font:"",init:function(){this.bind("draw",function(k){if(k.type==="DOM"){var j=this._element,i=j.style;j.innerHTML=this._text;i.font=this._font}else{}})},text:function(e){if(!e){return this._text}this._text=e;this.trigger("change");return this},font:function(e){this._font=e;this.trigger("change")}});d.c("health",{_mana:100,health:function(e){this._mana=e;return this},hurt:function(i){var e=this._mana;this._mana-=i;e-=this._mana;this.trigger("hurt",{by:i,diff:e,mana:this._mana});if(this._mana<=0){this.trigger("die")}return this},heal:function(e){this._mana+=e;return this}});d.c("score",{_score:0,incrementScore:function(e){this._score+=e;return this},decrementScore:function(e){this._score-=e;return this}})})(Crafty,window,window.document);