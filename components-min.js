(function(b){b.c("2D",{x:0,y:0,w:0,h:0,area:function(){return this.w*this.h},intersect:function(c){return this.x<c.x+c.w&&this.x+this.w>c.x&&this.y<c.y+c.h&&this.h+this.y>c.y},isAt:function(c,d){return this.x<=c&&this.x+this.w>=c&&this.y<=d&&this.y+this.h>=d},move:function(d,e){var c={x:this.x,y:this.y,w:this.w,h:this.h};if(d.charAt(0)==="n"){this.y-=e}if(d.charAt(0)==="s"){this.y+=e}if(d==="e"||d.charAt(1)==="e"){this.x+=e}if(d==="w"||d.charAt(1)==="w"){this.x-=e}this.trigger("change",c)}});b.c("gravity",{_gravity:1.1,init:function(){if(!this.has("2D")){this.addComponent("2D")}this.bind("enterframe",function(){var c={x:this.x,y:this.y,w:this.w,h:this.h};this.y*=this._gravity;this.trigger("change",c)})}});b.c("DOM",{_element:null,DOM:function(c){if(!this.has("2D")){this.addComponent("2D")}this._element=c;this._element.style.position="absolute";return this},draw:function(){this._element.style.top=Math.ceil(this.y)+"px";this._element.style.left=Math.ceil(this.x)+"px"}});b.extend({tile:16,sprite:function(f,d,c){var g,l,j,i,k,e;if(typeof f==="string"){c=d;d=f;f=16}this.tile=f;for(g in c){if(!c.hasOwnProperty(g)){continue}l=c[g];j=l[0]*f;i=l[1]*f;k=l[2]*f||f;e=l[3]*f||f;b.c(g,{__image:d,__coord:[j,i,k,e]})}return this},addEvent:function(e,d,c){if(window.attachEvent){window["e"+d+c]=c;window[d+c]=function(){window["e"+d+c](window.event)};window.attachEvent("on"+d,window[d+c])}else{window.addEventListener(d,function(f){c.call(e,f)},false)}},removeEvent:function(e,d,c){if(window.detachEvent){window.detachEvent("on"+d,window[d+c]);window[d+c]=null}else{window.removeEventListener(d,c,false)}},window:{width:window.innerWidth||(window.document.documentElement.clientWidth||window.document.body.clientWidth),height:window.innerHeight||(window.document.documentElement.clientHeight||window.document.body.clientHeight)},keys:{BSP:8,TAB:9,ENT:13,SHF:16,CTR:17,ALT:18,PAU:19,CAP:20,ESC:27,SP:32,PGU:33,PGD:34,END:35,HOM:36,LA:37,UA:38,RA:39,DA:40,INS:45,DEL:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,SEM:59,EQL:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:67,X:88,Y:89,Z:90,LWN:91,RWN:92,SEL:93,N0:96,N1:97,N2:98,N3:99,N4:100,N5:101,N6:102,N7:103,N8:104,N9:105,MUL:106,ADD:107,SUB:109,DEC:110,DIV:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM:144,SCR:145,COM:188,PER:190,FSL:191,ACC:192,OBR:219,BSL:220,CBR:221,QOT:222}});b.c("canvas",{init:function(){this.img=new Image();this.img.src=this.__image;this.w=this.__coord[2];this.h=this.__coord[3];this.bind("change",function(c){console.log("changed");c=c||this;b.context.clearRect(c.x,c.y,c.w,c.h);this.draw()})},append:function(){},draw:function(){var c=this.__coord;b.context.drawImage(this.img,c[0],c[1],c[2],c[3],Math.ceil(this.x),Math.ceil(this.y),this.w,this.h)}});b.extend({context:null,canvas:function(c){if(!("getContext" in c)){return}this.context=c.getContext("2d")},});b.c("controls",{init:function(){b.addEvent(this,"keydown",function(c){this.trigger("keydown",c)});b.addEvent(this,"keyup",function(c){this.trigger("keyup",c)});return this}});b.c("fourway",{__move:{left:false,right:false,up:false,down:false},fourway:function(d){var c=this.__move;this.bind("enterframe",function(){var e={x:this.x,y:this.y,w:this.w,h:this.h},f=false;if(c.right){this.x+=d;f=true}if(c.left){this.x-=d;f=true}if(c.up){this.y-=d;f=true}if(c.down){this.y+=d;f=true}if(f){this.trigger("change",e)}}).bind("keydown",function(f){if(f.keyCode===b.keys.RA){c.right=true}if(f.keyCode===b.keys.LA){c.left=true}if(f.keyCode===b.keys.UA){c.up=true}if(f.keyCode===b.keys.DA){c.down=true}}).bind("keyup",function(f){if(f.keyCode===b.keys.RA){c.right=false}if(f.keyCode===b.keys.LA){c.left=false}if(f.keyCode===b.keys.UA){c.up=false}if(f.keyCode===b.keys.DA){c.down=false}})}});b.c("twoway",{__move:{left:false,right:false,up:false,falling:false},fourway:function(d){var c=this.__move;this.bind("enterframe",function(){var e={x:this.x,y:this.y,w:this.w,h:this.h},f=false;if(c.right){this.x+=d;f=true}if(c.left){this.x-=d;f=true}if(c.up){this.y-=d;f=true}if(f){this.trigger("change",e)}}).bind("keydown",function(f){if(f.keyCode===b.keys.RA){c.right=true}if(f.keyCode===b.keys.LA){c.left=true}if(f.keyCode===b.keys.UA){c.up=true}}).bind("keyup",function(f){if(f.keyCode===b.keys.RA){c.right=false}if(f.keyCode===b.keys.LA){c.left=false}if(f.keyCode===b.keys.UA){c.up=false}})}});var a=(function(){var c=[];return{add:function(d){return c.push(d)},remove:function(d){delete c[d]},draw:function(){var e=0,d=c.length,f;for(;e<d;e++){if(c[e]){f=c[e].draw();if(f===-1){this.remove(e)}}}},debug:function(){console.log(c)}}})()})(Crafty);